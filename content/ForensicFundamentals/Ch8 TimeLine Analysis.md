---
title: "What is TimeLine Analysis"
metaTitle: "About Timeline"
metaDescription: " "
---

저장매체가 대용량화됨에 따라 저장매체에 저장되는 파일의 수는 보통 수십만 개에 이른다. 이 파일을 모두 상세 분석하는 것은 현실적으로 어렵고 파일 이외에도 삭제된 공간, 슬랙 공간, 비할당 공간 등 분석해야 할 영역이 다양하다. 게다가 대부분의 침해사고는 다수의 시스템이 감염되므로 분석해야할 데이터의 양도 상당하다. 이러한 경우 어떤 방법을 사용해야 할까?

 

가장 많이 사용하는 방법은 타임라인 분석이다. 사건이 일어난 시점을 중심으로 변화가 있었던 파일을 살펴보는 것이다. 만약 사건이 발생한 시점을 정확히 알 수 있다면 손쉽게 증거 관련 자료를 찾을 수 있지만 정확한 시점을 알고 있어도 어려운 사건도 있다. 후자의 경우 추가적인 분석이 필요하다.

사건 발생 시점을 가늠할 수 없는 경우에는 수십만 개의 파일을 모두 분석해야 하는가? 당연히 그렇지 않다. 이런 상황에서는 분석가의 경험과 판단이 중요하다. 사건의 성격에 따라 분석해야 할 대상의 우선 순위를 정해야 한다.

만약 회사 기밀이 외부로 유출됐다고 가정하자. 회사의 80~100명 규모의 회사로 업무망과 외부망을 분리해서 사용하고 있다. 주요 회사 기밀은 각 팀의 팀장만 접근할 수 있도록 접근 제어가 되어 있다. 공격자는 외부자일 수도 있지만, 내부자일 수도 있다. 네트워크를 이용한 유출도 가능하지만 물리적인 매체를 통한 유출도 가능하다.

위와 같은 상황에서 당신은 무엇부터 분석을 할 것인가? 정답은 없으니 하나씩 고민해보자.

시작을 어떻게 하느냐에 따라 결과가 나오기까지 많은 시간이 걸린다. 주어진 정보가 적다고 느낄 수 있지만 증상 혹은 의심만 가지고 분석에 임하는 경우에 비하면 많은 정보가 주어진 것이다.

분석 과정에서 비정상적인 흔적을 발견하면 해당 시점을 기준으로 다시 타임라인 분석을 수행하는 것이 일반 적이다. 타임라인 분석이 유용한 것은 사실이지만 항상 의미 있는 것은 아니다. 악성 코드를 가상환경에서 실행한 후 흔적을 살펴보면 타임라인 만으로 많은 것을 얻어 낼 수 있다. 하지만 APT ( Advanced Persistent Threat) 와 같은 공격 기법은 피해자가 공격이 발생한지 상당한 시간이 지난 이후에 공격을 인지하기 때문에 어려움이 많다.

 

타임라인 분석은 시간 정보를 필요로 한다. 운영체제와 application은 다양한 방법으로 시간 정보를 남긴다. 

1. 파일 시스템 시간 정보

2. 프리패치 파일의 생성 시간과 파일 내부의 최종 실행 시각

3. 레지스트리 하이브 구조에서 하이브 키의 마지막 접근 시간

4. EVT 이벤트 로그의 이벤트 생성 시간, 이벤트 작성 시간

5. EVTX 이벤트 로그의 이벤트 생성 시간

6. 링크 파일의 파일 시스템 시간과 내부에 저장된 대상의 생성/수정/접근 시간

7. 휴지통의 삭제 시간

8. IIS 로그의 이벤트 발생 시간

9. 인터넷 익스플로러 사용 흔적의 수정, 접근, 만료 시간

10. 크롬 사용 흔적의 방문 시간, 다운로드 시작 시간

11. 파이어폭스 사용 흔적의 방문 시간, 수정 , 접근, 만료, 다운로드 / 시작 / 종료 시간

12. XP 방화벽 로그의 이벤트 발생 시간

13. 시스템 복원 지점에 백업된 파일의 파일 시스템 시간 정보

이 외에도 응용프로그램마다 남기는 시간 정보는 다양하다. 시간 정보를 정렬하여 타임 라인 분석을 수행할 수 있다. 

단순히 정렬하여 살펴보는 방식 외에도 의미에 따라 살펴보는 방식도 있다.

예를들어 생성시간과 수정시간을 비교하거나, 파일시스템 시간과 파일 내부 시간의 연관관계와 같은 예가 있다. 이를 위해서는 각 시간 정보의 의미에 대해 잘 알고 있어야 하며 많은 경험이 필요하다. 

특히 NTFS의 시간 정보의 경우 내부 구조의 속성에 따라 4개씩 총 8개의 정보가 저장된다. 시간 정보는 서로 다른 특징을 가지며 이러한 특징을 기반으로 공격자의 의도를 살펴볼 수 있으며 사용자의 행위를 추적할 수 있다. 사건 발생이후 빠른 대응이 이어졌다면 $LogFile을 이용해 세밀하게 흔적을 추적할 수도 있다. 

최근에는 자동화로 타임라인을 추출할 수 있지만 이로 이용하여 특정행위를 판단하는 기준은 분석가의 몫이다.

 

여러 흔적에 대해 통합 타임라인 분석을 수행하는 것은 단일 흔적을 분석하는 것 보다 효과적이다. 하지만 최근의 공격기법은 매우 고급화가 되어 있어, 타임라인 분석기법을 무력화 하기 위한 기법을 많이 사용하여 각 흔적이 서로 연결되지 않아 흐름을 밝혀내지 못하는 경우도 있다.

이를 해결하기 위해 Forensic Readiness에 대한 연구가 활발하다. Forensic Readiness란 사건 발생시 분석을 신속하고 정확하게 하기 위해 사전에 준비가 되어있는지 검증하는 제도이다. 하드웨어 시스템 도입 또한 필요하겠지만 , 내부 보안 정책이 우선이다.

공격을 제대로 방어하기 위해서는 공격은 막을 수 없다 라는 전제를 인식할 수 잇어야 한다. 이를 위해 보안 컨설팅 이후, 시스템 운용 중에 포렌식 준비도에 대해 검증해보는 것이 필요할 것이다.

  출처 : http://forensic-proof.com/