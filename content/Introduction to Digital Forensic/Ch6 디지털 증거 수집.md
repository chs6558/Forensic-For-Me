---
title: "6장 디지털 증거 수집"
metaTitle: ""
metaDescription: ""
---

**디지털 증거가 법정에서 허용되기 위해서는 원본을 있는 그대로 보존하면서 수집해야 한다.**

휘발성 데이터와 같이 원본을 보존할 수 없는 경우는 최대한 원본과 유사한 형태로 수집하여야 하며, 관련 내용을 모두 기록해야 한다. 

## 조사 대상 매체 파악

먼저 범죄 현장에 도착하면 증거 훼손을 막기 위하여 현장 보호 조치를 취하고, 증거물의 위치를 파악해야 한다. 주요 조사 대상의 위치를 파악한 후 , 포렌식 수행 절차에 따라 진정성과 신뢰성을 보장하면서 증거물을 수집해야 한다. 또한 연계 보관성이 유지되도록 해야한다. 

1. **조사 대상 시스템 확보**

   **1) 컴퓨터 확보**

   사건 현장에서는 증거가 될 수 있는 모든 것을 파악해야 한다. 시스템 내에서 디지털 저장매체, 특히 하드디스크에 중요한 정보가 많이 기록되어 있기 때문에 핵심 증거물이라고 할 수 있다. 하드 디스크 드라이브는 압수 이후에 Imaging 과정을 거쳐 사본을 획득하고, 증거물을 분석한다. 컴퓨터 내부에 탑재된 HDD는 일반적으로 3.5 인치 HDD를 사용한다 랩톱에서는 2.5인치 HDD를 사용하며 점차 소형화 되고 있다. 

   **2) 기타 디지털 기기 수집**

   컴퓨터 이외의 기기에도 다양한 디지털 기기가 존재한다. 이러한 기기들에도 결정적인 증거가 저장되어 있을 확률이 있기 때문에 주의 깊게 봐야한다. 디지털 기기외에도 별도로 저장매체가 있는 경우에는 의도적으로 정보를 저장할 수 있기 때문에  주의깊게 확인해야 한다. 

   프린터에는 컴퓨터로부터 여러 페이지를 수신하여 저장하는 메모리 버퍼가 있으며, HDD를 가진 경우도 있다. 

   차량 항법 장치에서는 목적지 정보, 중간 지점, 경로를 통해 이전에 이동한 경로 정보를 획득할 수 있다. 또한 기록을 하는 경우도 있기 때문에 조사할 때 유용히 사용될 수 있다. 

   PDA는 보통 개인 수첩 용도로 사용되지만, 많은 기능이 탑재되어 있다. PDA뿐만 아니라 스마트폰 또한 필수 조사 대상이 되었다. 

   최근에는 콘솔 게임기 역시 컴퓨터와 같이 다양한 목적으로 활용되기 때문에 증거물 수집 대상에 포함된다.

   **3) 휴대용 저장 매체 확보**

   휴대용 저장 매체는 휴대할 수 있는 저장 장치로, 자료 전달과 보관을 목적으로 하기 때문에 핵심 증거가 있을 가능성이 높다. 

   휴대용 저장 매체가 점차 소형화 되면서 수색이 어려워지고 있다. 또한 컴퓨터는 구동하는데만 사용하고 실제 데이터는 저장매체에 보관하는 경향이 늘어나고 있다. 

   사건현장에서 이러한 매체를 은닉하는 경우가 많기 때문에 신중하게 현장을 살펴보아야 한다.

   이러한 은닉 방법 외에도 다양한 외형으로 출시되고 있기 때문에, 물리 증거에 대해서도 주의깊게 살펴보아야 한다. 

## 활성 시스템 조사

활성 시스템이란 정상적으로 가동중인 시스템을 말한다. 활성 시스템에서는 휘발성 정보와 비휘발성 정보를 모드 수집할 수 있다. **활성 시스템에서 데이터를 수집하는 경우에는 IEEE-1394 Interface와 같은 별도의 HW가 장착되어 있지 않다면 시스템의 모든 데이터를 있는 그대로 수집하는 것이 불가능하다.** 이로 인해 원본 훼손이 발생한다. 

그러나 Window Vista와 같이 BitLocker가 탑재되어 시스템을 자동으로 암호화 하는 경우에는 활성 상태에서 디지털 데이터를 수집하는 것이 효과적이며, 서비스 중인 서버처럼 시스템을 종료 할수 없는 경우도 있으므로 불가피하게 활성 시스템에서 데이터를 수집해야하는 상황도 있다. 또한 침해 사고와 같이 실시간으로 공격이 이루어질 때는 현재 상황이 중요하므로 휘발성 데이터를 수집해야 한다. 

요새는 프라이버시에 대한 관심이 증가하여 모든 데이터가 아니라 데이터를 선별하여 수집되는 형태가 선호된다. 

활성시스템은 악의정인 사용자에 의해 각종 명령어가 변경되어 있을 수 있기 때문에, 시스템에 있는 명령어를 이용한 데이터 수집은 피하고, 읽기만 가능한 도구를 저장하여 사용해야 한다.  또한 수집한 데이터를 저장하기 위한 별도의 매체가 있어야 한다. 이를 위해 데이터 수집 도구를 CD에 저장하고 수집한 데이터는 이동형 저장 장치에 저장하거나, 네트워크를 이용하여 증거 수집 서버에 전송하는 방법이 있다. 다른 방법으론 USB Flash Driver의 일부 영역을 읽기만 가능하게 바꾼 후 증거 수집 도구를 저장하고, 수집한 데이터는 쓰기 가능한 영역에 저장하는 방식이 있다. 

**활성 시스템을 조사할 때 고려해야하는 사항**

- 휘발성 데이터 수집 필요성
- 활성 시스템에서 비휘발성 데이터의 수집 필요성
- 수집한 비휘발성 데이터와 원본의 동일성
- 수집 도구를 사용함으로써 시스템에 영향을 주는 요인

활성 시스템을 조사할 때는 시스템에 어떠한 방식으로든 영향을 미치게 된다. 따라서 **시스템 변경을 최소화 하는 신뢰성 있는 도구를 사용해야 하며, 작업한 모든 내용을 기록해야 한다.**  **데이터 수집시에도 휘발성이 높은 것 부터 우선적으로 수집해야 한다.** 

1. **IEEE-1394 Interface를 이용한 물리 메모리 획득**

   활성 시스템에서 휘발성 데이터의 훼손을 최소화하는 방법으론 IEEE-1394 interface를 이용하는 방법이 있다. 

   ![](https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/FireWire_800_port.jpg/330px-FireWire_800_port.jpg)

   그림 출처 : https://en.wikipedia.org/wiki/IEEE_1394

   Firewire 또는 i.Link 라고도 불리며 디지털 캠코더, HDTV 등의 영상 기기에 사용되는 시리얼 버스이다. IEEE-1394를 통해 시스템의 메모리에 직접 접근할 수 있는 이유는 **Direct Memory Access를 사용하기 때문**이다.  DMA는 메인 보드에 장착되어 있는 장치로 **CPU의 처리 속도와 입/출력 장치의 속도 차이를 개선하기 위해 사용**된다. IEEE-1394는 DMA에 직접 명령을 내릴 수 있는 버스 마스터 장치이기 때문에, CPU의 제어 없이 독릭접으로 시스템의 물리 메모리 영역에 읽기 및 쓰기 명령을 내릴 수 있다. 즉, OS의 종류와 상태에 관계없이 IEEE-1394 장치가 활성화 되어 IEEE-1394장치를 연결해 명령을 전달할 수 있다. 이러한 방식으로 시스템에 변화를 주지않고 물리 메모리 영역을 수집할 수 있다. 

   1. Host 시스템과 획득 대상이 되는 target 시스템을 IEEE-1394로 연결
   2. Host 시스템에 IEEE-1394에 읽기 명령을 내릴 수 있도록 프로그램 구성

   * 리눅스의 1394 memimage를 이용하여 물리 메모리 영역 획득이 가능하다. 

   사용자 인증이 이루어져 있지 않거나 잠긴 상태의 윈도우 경우, IEEE-1394를 이용하여 인증 정보를 담고 있는 SAM Registry 영역의 값을 초기화 하여 인증 과정을 우회할 수 있다. 

   

2. **휘발성 데이터** 

   휘발성 데이터는 시스템이 종료되면 확보하지 못하는 데이터로, 활성 시스템 상태에서 가능한 빠르고 정확하게 확보하는 것이 중요하다. **휘발성 증거 수집 과정 자체가 시스템의 상태를 변경할 수 있기 때문에, GUI 의 사용을 피하고 CLI 의 사용을 권장한다.**  또한 악성 코드에 의해 오염될 수 있기때문에 읽기만 가능한 매체에서 사용해야 한다. 

   조사 도구를 구동하면 해당 작업을 하는 Process가 생성되어 RAM에 올라가기 때문에 RAM부터 수집하는 것이 원칙이며, 이후 필요한 휘발성 데이터를 수집한다. 

   **1) 프로세스 정보**

   시스템이 악영향을 미치는 악성 프로그램 or 이상 process를 선별을 비롯하여 메모리 상태를 파악하기 위해서는 프로세스 정보를 수집해야 한다. 

   

   | 수집 도구 또는 명령어(WINDOW) | 설명                                                         |
   | ----------------------------- | ------------------------------------------------------------ |
   | tasklist                      | 시스템의 프로세스 상태 파악                                  |
   | pslist                        | 실행 중인 프로세스의 자세한 정보를 보여줌                    |
   | listdlls                      | 프로세스에 종속되거나 로드된 DLL 목록을 확인                 |
   | handle                        | 프로세스가 사용하고 있는 모든 handle 확인                    |
   | ProcessExplorer (GUI)         | 프로세스 관리자 프로그램으로 각 프로세스의 구동 여부와 해당 프로세스가 사용하는 DLL의 정보, 메모리 매핑 등 다양한 정보 제공 |

   | 수집 도구 또는 명령어 | 설명(LINUX)                                  |
   | --------------------- | -------------------------------------------- |
   | ps                    | 실행중인 프로세스 정보                       |
   | top                   | 실시간 프로세스 상태 모니터링                |
   | pstree                | 실행 중인 프로세스 정보를 트리 형식으로 제공 |
   | cat /proc/[pid]/항목  | cmdline, cwd, environ, exe, fd, status       |
   | pmap                  | 프로세스의 메모리상 주소 공간 정보 확인      |

   전원을 차단하지 않을 경우, 종료된 프로세스가 일주일 이상 RAM에 잔류하는 경우도 있기 때문에 dump한 RAM에서 프로세스에 관한 구조체를 검색하면 은닉 프로세스 탐지 및 이전에 실행한 프로세스 목록을 추출할 수 있다. 

   **2) 시스템 정보**

   시스템 정보에는 시간 정보, 계정 정보, 디스크 정보 3가지가 있다. 

   | 수집 항목(WINDOW) | 수집 방법                                   |
   | ----------------- | ------------------------------------------- |
   | 시스템 시간 정보  | date 명령어를 사용                          |
   | 현재 로그온 계정  | net users<br />net sessions<br />psloggedon |
   | 디스크 정보       | di (윈도우 tools)                           |

   | 수집 항목(LINUX) | 수집 방법                                                    |
   | ---------------- | ------------------------------------------------------------ |
   | 시스템 관련 정보 | date : 현재시간, uptime : 활성시간 정보<br />uname : 현재 작동중인 시스템 정보 |
   | 사용자 관련 정보 | who : 현재 로그인 상태인 사용자 정보 확인<br />last : 가장 최근 로그인한 사용자 정보<br />w : 각 사용자가 진행중인 작업 확인 |
   | 운영체제 정보    | /proc/version : 커널 버전 정보 , /proc/cpuinfo : CPU 정보<br />/proc/uptime : 활성시간 정보, /proc/stat : 시스템 상태<br />/proc/meminfo : 메모리 사용량, /proc/loadavg : 평균 부하량 |

   **3) 네트워크 정보**

   네트워크 정보는 현재 네트워크 연결 및 사용정보를 바탕으로 비인가 접속을 판별하기 위해 수집해야 한다. 현재 열견된 IP 주소와 port 등에 대한 점검, 연결 상태와 프로세스 별 연결 포트를 확인하여 허가되지 않은 사용 정보를 수집해야 한다. 

   

   | 수집 항목(window)                         | 수집 방법                           |
   | ----------------------------------------- | ----------------------------------- |
   | 현재 네트워크 연결 정보                   | netstat -ano                        |
   | 열린 네트워크 포트와 연결된 프로세스 정보 | Fport                               |
   | 공유 파일                                 | net file<br />openfiles<br />psFile |

   | 수집 항목                 | 수집 방법                               |
   | ------------------------- | --------------------------------------- |
   | IP 설정 정보              | ifconfig -a                             |
   | 라우팅 테이블 정보        | netstat -n 혹은 route                   |
   | ARP 정보                  | arp -a                                  |
   | TCP, UDP 상태 정보        | netstat -anp                            |
   | 포트 별 프로세스 정보     | netstat -lnp                            |
   | 네임서버 파일             | /etc/hosts                              |
   | Listen 포트 관련 프로세스 | lsof \| grep LISTEN, lsof \| grep [pid] |

   

3. **비활성 데이터**

   비활성 데이터는 휘발성 데이터와 반대되는 개념으로 전원을 차단해도 사라지지 않는 데이터를 말한다. 기본적으로 쓰기 방지 장치를 부착하는 것이 원칙이지만, 시스템을 종료 시키지 못하는 환경에서는 활성 시스템에서 직접 데이터를 수집할 수도 있다. 또한 disk 이미지 기반의 조사는 많은 시간이 소요되기 때문에 사건과 관련된 비활성 데이터만을 수집하는 경우도 있다. 

   윈도우 시스템은 레지스트리에 다양한 정보를 저장하고 있어, 상당히 유용한 정보를 획득할 수 있다. 또한 활성 상태에서는 Encrypted File System에 접근할 수 있고, BitLocker의 복구용 키도 생성할 수 있기 때문에 계정 패스워드가 있어야만 접근할 수 있도록 설정된 보호 기능을 우회할 수 있다. 

   리눅스에서는 포렌식 여러 설정 정보를 환경 설정 파일을 통해 얻어야 한다. 리눅스 시스템 별로 경로 및 존재여부 등이 다를 수 있기 때문에 주의해야 한다.

   

4. **활성 시스템 데이터 수집**

   활성 시스템에서 휘발성 데이터와 비휘발성 데이터는 운영체제의 종류마다 다르고, API또한 다르기 때문에 활성 시스템 데이터 수집 도구는 이러한 특성을 고려하여 개발되어야 한다. 

   휘발성 데이터를 수집할 때, 소프트웨어로만 수집하면 시스템의 변경은 불가피 하다. 포렌식 관점에서는 변경을 최소화 하여야 하기 때문에 GUI 대신 CLI를 사용하고, 라이브러리가 static으로 되어있는 도구를 사용하고, 읽기만 가능한 매체에서 실행할 것을 권장한다. 

## 디스크 이미징

하드 디스크에는 대부분의 증거물이 보관되어 있다. 따라서 포렌식 조사를 할 때는 하드 디스크 원본을 보존하는 것이 매우 중요하다. 사용자가 아무런 조작을 하지 않아도 OS는 Hard Disk에 있는 data를 변경한다. 따라서 **HDD를 수집하면 원본 보존과 추후 분석을 위해서 그대로 복제하는데 이를 Imaging**이라고 한다.

1. **디스크 이미지**

   **디스크 이미지는 원본 디스크에 저장되어 정보의 모든 비트 스트림을 포함하는 사본 파일을 말한다.** 이러한 과정을 통해 생성된 image data는 imaging 작업 방법에 따라 압축 될 수 있으며 부가 정보를 포함할 수 있다. 

   dd 는 원본 디스크를 있는 그대로 하나의 파일로 생성하기 때문에 raw 이미지라고 말한다. Encase는 원본을 64 sector별로 분할 압축하여 저장하며, 이미지 관리를 위한 meta 정보를 덧붙이는 방식으로 사용한다. 

   또 하드웨어 기반 이미지 생성 도구도 있는데 이는 매우빠르기 때문에 신속한 이미징 작업이 필요한 경우 효과적이다.  

2. **디스크 이미지 생성**

   전체 디지털 포렌식 수행 절차의 초기 단계이지만, 전체 조사 성과를 결정짓는 중요한 단계 중 하나로 **조사 과정에서 발생할 수 있는 원본 데이터에 대한 손상을 방지하는 작업 과정이다.** 
   

   **1) 조사 대상 시스템에서 Bootable CD를 활용한 디스크 이미징**

   조사 대상 시스템에서 저장 매체를 분리하지 않은 상태에서 이미징 하려면 Bootable CD를 활용한다. **Bootable CD란 물리 메모리만을 이용해 시스템을 부팅할 수 있게 운영체제를 저장한 CD를 말한다.**  이 경우에는 기존 시스템에 부착되어 있던 저장 매체를 읽기 전용으로 마운트할 수 있어 데이터의 무결성을 손상시키지 않고 이미징할 수 있다.

   현재 Helix, BackTrack, Knoppix 등 리눅스 시스템을 기반으로 한 Bootable CD가 널리 사용되고 있다. 

   Helix는 리눅스의 일종인 Ubuntu를 기반으로 한 Bootable CD이다. 

   이 부분은 나중에 실습으로 다루어 보자.

   **2) 조사용 시스템에서의 디스크 이미징**

   조사 대상 시스템에서 저장 매체를 분리한 후, 조사용 시스템에 부착해서 이미징을 하기 위해서는 Write blocker와 함께 이미징 기능을 갖춘 전용 도구를 사용한다. **저장매체는 무결성 손상 방지를 위해서 반드시 읽기 전용으로 조사용 시스템에 부착되어야 하며 이를 위해 Write blocker를 사용한다.** 

## 임베디드 시스템 증거 확보

휴대폰과 같은 임베디드 시스템은 장치 내부의 메모리에 직접 접근할 수 있는 인터페이스가 없다. 때문에, 모든 데이터를 수집하는 것이 어려우며, 메타데이터 및 비할당 영역을 수집하지 못하고, 파일 또는 컨텐츠만을 수집하는 경우도 있다.

1. **물리적 수집 방법**

   **하드 디스크 이미징처럼 증거를 수집하기 위해 원본 장치의 저장 매체를 bit-by-bit 방식으로 복사하는 것으로 완벽히 동일한 사본을 얻을 수 있다.** 

   **1) JTAG을 이용한 물리적 증거 수집**

   JTAG은 하드웨어 보드를 디버깅하기 위해 개발된 표준이다. 소프트웨어와 다르게 하드웨어 보드에 내장되는 프로그램은 어떤 문제가 발생하는지를 알아내기 매우 어렵다. 이러한 문제를 해결하기 위해 **하드웨어 보드에 표준화된 로직과 테스트를 위한 핀을 내장하도록 한 것이 JTAG**이다.

   ![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2FbxCMMC%2FbtqvWSE698C%2FZWJzhnnGrrCHpWImiwgJHK%2Fimg.jpg) 

   JTAG는 아래와 같이 구성되어 있다.

   ![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2Fu0XVG%2FbtqvX0vFFSs%2FsGqCBbDKYKa5yhMWgIwBk0%2Fimg.jpg)

   그림 출처 : https://butter-shower.tistory.com/22

   JTAG는 산업 표준으로, 모든 임베디드 기기에 적용할 수 있다. 그러나 **JTAG를 사용할 수 있으면 임베디드 기기에 내장되어 있는 펌웨어가 노출될 위험이 있다**. 따라서 대부분의 제조사는 JTAG interface를 차단하거나 숨기므로 보편적으로 사용하지는 못한다. 

   

   **2) 직접 메모리 접근을 통한 물리적 증거 수집**

   **임베디드 기기의 보드에서 플래쉬 메모리를 분리하여 메모리 리더기를 통해 데이터를 수집하는 방법이다.** 직접 메모리 방법은 보드에서 메모리를 분리하는 방식이기 때문에, 다른 방법을 이용할 수 없는 경우에 한하여 사용해야 한다. 

   분리된 메모리는 접찬된 부분의 핀이 손상되어 있을 수 있으므로, 리더기를 통해 읽기전에 핀을 복원하는 리볼빙 과정을 거치고 리더기를 이용하여야 한다. 

   

2. **논리적 증거 수집 방법**

   **메타데이터와 비할당 영역을 제외한 파일 또는 파일의 컨텐츠를 복사하는 방법이다.** 

   **파일 단위 접근 방식**은 **USB 통신 프로토콜 또는 제조사에서 제공하는 파일 접근 USB 명령을 통해 파일을 가져오는 방식**이다. 한 파일내에 여러 데이터가 레코드 형식으로 기록되어 있는 경우, 데이터를 삭제하면 application에서 단순히 플래그로 삭제된 표시만 하고 외부로 출력하지 않는 사례가 있어, 파일 포맷을 분석하면 삭제된 데이터도 복구할 수 있다. 

   **컨텐츠 단위의 접근 방식**은 **제조사에서 제공하는 PC-Link 소프트웨어 등을 이용하여 수집하는 방식**으로 OS 또는 소프트웨어에 의해서 삭제된 데이터는 필터링 되어 수집되므로 화면에 나타나는 데이터만 수집 가능하다. 

   **1) 파일 단위 접근**

   임베디드 기기와 PC를 USB 케이블을 이용하여 연결한다. 

   PC에서 임베디드 기기내의 디렉터리에 대한 정보를 요청한다.

   접근 권한을 획득한 후, 파일 목록을 받는다. 

   파일 목록을 받으면, 해당 파일에 접근할 수 있는 권한을 획득 한다.

   파일의 내용을 전송한다.

   **2) 컨텐츠 단위 접근**

   제조사에서 제공하는 PC-Link 소프트웨어를 이용한다. 각 제조사의 기기에 맞는 USB 드라이버가 포함되어 있어 모든 기기에 적용할 수 있다. **증거 획득 기술에서 가장 범용적으로 활용할 수 있으나, 데이터가 매우 제한적이고 효용성이 떨어진다.**

   **3) 백업 소프트웨어를 통한 접근**

   임베디드 기기는 대체로 PC와 연계하여 사용할 수 있도록 백업 기능 또는 동기화 기능을 제공한다.  이를 활용하여 임베디드 기기에 저장되어 있는 데이터를 수집할 수 있다. 접근시, PC에 저장된 데이터가 임베디드 기기로 전송되지 않도록 주의해야 한다. 

   백업 파일의 포맷에 따라 분석을 수행해야 하므로, 파일 형식에 대한 분석이 병행되어야 한다. 

   